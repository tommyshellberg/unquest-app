appId: com.vaedros.unquest.staging
---
# =============================================================================
# SECOND QUEST TEST - Fresh Authenticated User
# =============================================================================
# Tests completing a second quest as an authenticated user
#
# Expected Starting State:
#   - Level: 1
#   - XP: 50
#   - Quests completed: 1
#   - Streak: Day 1
#
# Expected Ending State:
#   - Level: 1 (or 2 if XP threshold crossed)
#   - XP: 100 (50 + 50)
#   - Quests completed: 2
#   - Streak: Day 2 (assuming same day)
# =============================================================================

# Navigate to Home tab
- tapOn:
    text: 'Home'
    index: 0

# =============================================================================
# VERIFY HOME SCREEN LOADS
# =============================================================================
- assertVisible: 'Your Journey'
- assertVisible: 'emberglow'

# =============================================================================
# SELECT NEXT AVAILABLE QUEST
# =============================================================================
# The app should show the next quest in the storyline
# After "Wake up", the next quest might be different, so we'll tap on
# the first available quest button

- runFlow:
    when:
      visible: 'Continue Your Journey'
    commands:
      # Tap the first quest option that appears
      - tapOn:
          point: '50%, 60%'  # Center area where quest cards typically appear

# Fallback: look for common quest titles
- runFlow:
    when:
      visible: 'Path of Shadows'
    commands:
      - tapOn: 'Path of Shadows'

- runFlow:
    when:
      visible: 'Morning Routine'
    commands:
      - tapOn: 'Morning Routine'

# =============================================================================
# PENDING QUEST SCREEN
# =============================================================================
- extendedWaitUntil:
    visible: 'Quest Ready'
    timeout: 10000

- assertVisible: 'Lock your phone to begin your quest'

# =============================================================================
# START QUEST BY LOCKING PHONE
# =============================================================================
- pressKey: Lock

# =============================================================================
# WAIT FOR QUEST COMPLETION (2.5 minutes)
# =============================================================================
- repeat:
    times: 30
    commands:

# =============================================================================
# UNLOCK AND VERIFY QUEST COMPLETION
# =============================================================================
- pressKey: Lock

# Swipe to unlock
- swipe:
    start: 50%, 80%
    end: 50%, 20%
    duration: 500


# =============================================================================
# QUEST COMPLETION SCREEN - EXACT VALUE ASSERTIONS
# =============================================================================
- extendedWaitUntil:
    visible: 'Quest Complete'
    timeout: 10000

# Verify exact XP reward (assuming 50 XP again)
- assertVisible:
    text: '50'
    below: 'XP Gained'

- tapOn: 'Continue'

# =============================================================================
# SECOND QUEST COMPLETE
# =============================================================================
# User should now have:
#   - 100 total XP (50 + 50)
#   - 2 quests completed
#   - Potentially Day 2 streak (or streak celebration screen should appear)

appId: com.vaedros.unquest.staging
---
# =============================================================================
# ONBOARDING E2E TEST - PART 1: UP TO QUEST LOCK
# =============================================================================
# This test covers the guest user onboarding flow up to locking the phone:
#   1. Welcome screen
#   2. Character creation (name + type selection)
#   3. App introduction screens
#   4. Notification permissions
#   5. First quest selection
#   6. Lock phone to start quest
#
# After this test completes, run-tests.sh will wait 15 seconds for the
# 10-second quest to complete (with 5-second buffer), then run part 2.
# =============================================================================

- clearState
- launchApp

# =============================================================================
# ENSURE DEVICE IS UNLOCKED
# =============================================================================
# Unlock the device if it's locked (swipe up from bottom)
- swipe:
    start: 50%, 95%
    end: 50%, 5%
    duration: 300

# =============================================================================
# NO DEVELOPMENT ENVIRONMENT SCREENS IN STAGING BUILDS
# =============================================================================
# Staging builds are production-like (no expo-dev-client) so no dev menu or
# dev server selection screens will appear. Tests can proceed directly to app.

# =============================================================================
# WELCOME SCREEN
# =============================================================================
- assertVisible: 'emberglow'
- assertVisible: 'Level Up By Logging Off'
- assertVisible: 'Begin New Journey'

- tapOn: 'Begin New Journey'

# =============================================================================
# CHARACTER NAME SCREEN
# =============================================================================
- assertVisible: 'Your Character'
- assertVisible: 'Character Name'

- tapOn: 'Enter character name'
- inputText: 'MaestroHero'
- tapOn: 'Continue'

# =============================================================================
# CHARACTER TYPE SELECTION
# =============================================================================
- assertVisible: "Hello, MaestroHero"
- assertVisible: 'ALCHEMIST'

# Test carousel by swiping through characters
- swipe:
    start: 80%, 50%
    end: 20%, 50%
    duration: 500

- assertVisible: 'BARD'

- swipe:
    start: 80%, 50%
    end: 20%, 50%
    duration: 500

- assertVisible: 'DRUID'

# Swipe back to Alchemist
- swipe:
    start: 20%, 50%
    end: 80%, 50%
    duration: 500

- swipe:
    start: 20%, 50%
    end: 80%, 50%
    duration: 500

- assertVisible: 'ALCHEMIST'
- tapOn: 'Create Character'

# =============================================================================
# HANDLE APP INTRO SCREENS
# =============================================================================
- runFlow:
    when:
      visible: 'emberglow'
    commands:
      - tapOn: 'Got it'

- runFlow:
    when:
      visible: 'Notifications'
    commands:
      - tapOn: 'Enable notifications'
      # Handle system permission if it appears
      - runFlow:
          when:
            visible: '.*Allow.*'
          commands:
            - tapOn: 'Allow'

# =============================================================================
# FIRST QUEST SCREEN
# =============================================================================
- assertVisible: 'Your Journey Begins'
- assertVisible: 'Wake up'

- tapOn: 'Wake up'

# =============================================================================
# PENDING QUEST SCREEN
# =============================================================================
- extendedWaitUntil:
    visible: 'Start Quest'
    timeout: 10000

- assertVisible: 'Lock your phone to begin'

# Test quest cancellation (edge case)
- assertVisible: 'Cancel Quest'
- tapOn: 'Cancel Quest'

# Should be back at quest screen
- assertVisible: 'Your Journey Begins'
- assertVisible: 'Wake up'

# Start quest again
- tapOn: 'Wake up'

- assertVisible: 'Start Quest'

# =============================================================================
# START QUEST BY LOCKING PHONE
# =============================================================================
# Note: Lock command behavior varies by platform:
# - iOS Simulator: Works reliably
# - Android Emulator: May not actually lock the screen
# If lock doesn't work, quest will still start based on app logic
- pressKey: "Lock"

# =============================================================================
# END OF PART 1
# =============================================================================
# Phone is now locked and quest has started.
# Shell script will wait 15 seconds for quest completion before running part 2.
